# Pre-commit hooks for code quality
# Install: poetry run pre-commit install
# Run manually: poetry run pre-commit run --all-files

repos:
    # General file checks
    - repo: https://github.com/pre-commit/pre-commit-hooks
      rev: v4.5.0
      hooks:
          - id: trailing-whitespace
            exclude: '\.md$'
          - id: end-of-file-fixer
          - id: check-yaml
            exclude: '^(deployment/helm/)'
          - id: check-json
          - id: check-added-large-files
            args: ['--maxkb=1000']
          - id: check-merge-conflict
          - id: check-case-conflict
          - id: mixed-line-ending
            args: ['--fix=lf']

    # Python formatting with Black
    - repo: https://github.com/psf/black
      rev: 24.1.1
      hooks:
          - id: black
            language_version: python3.10
            args: ['--line-length=88']

    # Python import sorting with isort
    - repo: https://github.com/PyCQA/isort
      rev: 5.13.2
      hooks:
          - id: isort
            args: ['--profile', 'black', '--line-length', '88']

    # Python linting with flake8
    - repo: https://github.com/PyCQA/flake8
      rev: 7.0.0
      hooks:
          - id: flake8
            args:
                - '--max-line-length=88'
                - '--extend-ignore=E203,W503'
                - '--exclude=.git,__pycache__,.venv,build,dist'

    # Python type checking (optional, can be commented out if not using)
    # - repo: https://github.com/pre-commit/mirrors-mypy
    #   rev: v1.8.0
    #   hooks:
    #     - id: mypy
    #       additional_dependencies: [types-all]

    # JavaScript/TypeScript/CSS formatting with Prettier
    - repo: https://github.com/pre-commit/mirrors-prettier
      rev: v4.0.0-alpha.8
      hooks:
          - id: prettier
            types_or: [javascript, jsx, ts, tsx, css, scss, sass, html, json, yaml, markdown]
            exclude: '^(package-lock\.json|poetry\.lock|deployment/helm/)'
            args: ['--config', '.prettierrc']

    # Markdown linting
    - repo: https://github.com/igorshubovych/markdownlint-cli
      rev: v0.39.0
      hooks:
          - id: markdownlint
            args: ['--config', '.markdownlint.json', '--fix']
            exclude: '^(node_modules/|\.venv/)'

    # YAML linting
    - repo: https://github.com/adrienverge/yamllint
      rev: v1.35.1
      hooks:
          - id: yamllint
            args:
                [
                    '-d',
                    '{extends: default, rules: {line-length: {max: 120}, document-start: disable}}',
                ]
            exclude: '^(deployment/helm/)'

    # Security check for Python dependencies
    - repo: https://github.com/PyCQA/bandit
      rev: 1.7.6
      hooks:
          - id: bandit
            args: ['-c', 'pyproject.toml']
            additional_dependencies: ['bandit[toml]']

    # Check for secrets/credentials
    - repo: https://github.com/Yelp/detect-secrets
      rev: v1.4.0
      hooks:
          - id: detect-secrets
            args: ['--baseline', '.secrets.baseline']
            exclude: 'package-lock\.json|poetry\.lock'

# Configure pre-commit to run only on changed files by default
default_install_hook_types: [pre-commit, pre-push]
